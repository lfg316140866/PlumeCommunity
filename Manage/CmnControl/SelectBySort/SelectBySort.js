CmnMis_UI_Control_SelectBySort_Version = "2.1", function () { var a = CmnMis.UI.Control; a.SelectBySort = function (b, c) { Cmn.Object.Inherit(this, a.BasControl, [b, c]); var d = this; this.Type = "SelectBySort", this.IsExistHtmlTemp = !0, this.OnDataLoadComplete = new Cmn.Event(this), d.SetCfgDescCfg({ FillSql: { Type: "TextArea", Desc: "sql或者接口名称" }, Sorts: { Type: "MultiCfgList", Desc: "分类配置", CfgList: [{ Desc: { Type: "Text", Desc: "类型描述" } }, { FillSql: { Type: "TextArea", Desc: "sql语句" } }, { ForeignKeyFieldName: { Type: "Text", Desc: "外键字段" } }, { ParentID: { Type: "Text", Desc: "分类父代码" } }, { Level: { Type: "Text", Desc: "分类深度" } }] }, DisplayFieldCount: { Type: "Text", Desc: "显示字段的个数", Val: "2" }, Limit: { Type: "Text", Desc: "显示的数据条数", Val: "10" } }), this.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), this.InterfaceUrl = InterfaceUrl, this.InitControl = function () { var b = this; if (Cmn.GetUUID(), b.ControlCfg = Cmn.Extend({ Sorts: [] }, b.ControlCfg), Cmn.IsType(b.ControlCfg.Sorts, "string")) try { b.ControlCfg.Sorts = $.parseJSON(b.ControlCfg.Sorts) } catch (f) { b.ControlCfg.Sorts = [] } b.Selector = { Wrap: ".cmn-SelectBySort-Wrap", Sort: ".cmn-SelectBySort-Sort", SortsWrap: ".cmn-SelectBySort-SortsWrap", Input: ".cmn-SelectBySort-Input", OptionList: ".cmn-SelectBySort-OptionList", OptionListItem: ".cmn-SelectBySort-OptionListItem", Text: ".cmn-SelectBySort-OptionListItemText", Select: ".Select" }, Cmn.UI && Cmn.UI.BasPlugin || CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/CmnUI/CmnUI.js"), Cmn.UI && Cmn.UI.AutoComplete || CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/CmnUI/AutoComplete/AutoComplete.js"), d.AutoComplete = new Cmn.UI.AutoComplete(d.ControlDom.find("input"), d.InterfaceUrl), d.AutoComplete.SerializeParam = function (a) { return { method: "ExecSql", param: a, Limit: d.ControlCfg.Limit, DisplayFieldCount: d.ControlCfg.DisplayFieldCount, ExecSql: d.ControlCfg.FillSql } }, d.AutoComplete.OnDataLoadComplete.Add(function (a) { d.OnDataLoadComplete.Trigger([a]) }, "cmn-Control-SelectBySort-OnDataLoadComplete"), d.AutoComplete.OnChange.Add(function (a, b, c) { d.OnChange.Trigger([a, b, c]) }, "cmn-Control-SelectBySort-OnChange"), b.ControlCfg.Sorts.length <= 0 && (d.ControlDom.find(".cmn-SelectBySort-FilterBtn").hide(), d.ControlDom.find("input").css({ width: "100%" })) }, this.GetValue = function () { return d.AutoComplete.GetValue() }, this.SetValue = function (a) { "undefined" != Cmn.IsType(a) && "" != a && null != a ? CmnAjax.PostData(d.InterfaceUrl, { method: "ExecSql", Limit: "1", ExecSql: d.ControlCfg.FillSql, param: a }, function (a) { d.AutoComplete.SetValue(a.data) }) : d.AutoComplete.SetValue() }, this.Init = function () { d.SetValue(d.ControlCfg.Default || "") } } }();